syntax = "proto3";

package gateway;

service GatewayService {
  rpc CreateRoom(CreateRoomRequest) returns (RoomOpReply);
  rpc DeleteRoom(DeleteRoomRequest) returns (RoomOpReply);

  rpc EnterRoom(EnterRoomRequest) returns (RoomOpReply);
  rpc LeaveRoom(LeaveRoomRequest) returns (RoomOpReply);

  rpc GetPeople(GetPeopleRequest) returns (GetPeopleReply);
    // --- messaging ---
  rpc SendMessage(SendMessageRequest) returns (SendMessageReply);
  rpc Subscribe(SubscribeRequest) returns (stream ChatMessage);
  rpc GetHistory(GetHistoryRequest) returns (GetHistoryReply);
}

message Auth {
  string credential = 1;
}

message CreateRoomRequest {
  Auth auth = 1;
  string room_name = 2;
}

message DeleteRoomRequest {
  Auth auth = 1;
  string room_name = 2;
}

message EnterRoomRequest {
  Auth auth = 1;
  string room_name = 2;
  string person_name = 3;
}

message LeaveRoomRequest {
  Auth auth = 1;
  string room_name = 2;
  string person_name = 3;
}

message GetPeopleRequest {
  Auth auth = 1;
  string room_name = 2;
}

message RoomOpReply {
  bool ok = 1;
  string message = 2;
}

message GetPeopleReply {
  repeated string people = 1;
}
message SendMessageRequest {
  Auth auth = 1;
  string room_name = 2;
  string person_name = 3;
  string text = 4;
  int64 client_ts_ms = 5;
  string msg_id = 6;
}

message SendMessageReply {
  bool ok = 1;
  string message = 2;
  int64 server_seq = 3;
  int64 server_ts_ms = 4;
}

message SubscribeRequest {
  Auth auth = 1;
  string room_name = 2;
  string person_name = 3;
}

message ChatMessage {
  string room_name = 1;
  string person_name = 2;
  string text = 3;
  int64 server_seq = 4;
  int64 client_ts_ms = 5;
  int64 server_ts_ms = 6;
  string msg_id = 7;
}

message GetHistoryRequest {
  Auth auth = 1;
  string room_name = 2;
  int32 limit = 3;
}

message GetHistoryReply {
  repeated ChatMessage messages = 1;
}
